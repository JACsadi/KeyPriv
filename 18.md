  # i18n Quick Reference Guide - DEAP Frontend

> **Primary Reference for all internationalization (i18n) implementation in DEAP Suite**
>
> Last Updated: 2025-11-06
>
> **CRITICAL**: This is the authoritative source for i18n implementation. Follow this guide step-by-step for every new page/module.

---

## Table of Contents
- [Quick Start](#quick-start)
- [Critical Rules](#critical-rules)
- [Step-by-Step Implementation](#step-by-step-implementation)
- [Common Failures & Solutions](#common-failures--solutions)
- [Validation & Testing](#validation--testing)
- [Code Review Checklist](#code-review-checklist)

---

## Quick Start

### Copy-Paste Template for New Module

```bash
# 1. Create translation files (3 minimum locales)
touch i18n/messages/en-US/my-module.json
touch i18n/messages/bn-BD/my-module.json
touch i18n/messages/ar-SA/my-module.json

# 2. â›” DO NOT add to static-imports.ts (deprecated!)

# 3. Register in en-US/index.ts
echo "export { default as myModule } from './my-module.json';" >> i18n/messages/en-US/index.ts

# 4. Register in bn-BD/index.ts
echo "export { default as myModule } from './my-module.json';" >> i18n/messages/bn-BD/index.ts

# 5. Register in ar-SA/index.ts
echo "export { default as myModule } from './my-module.json';" >> i18n/messages/ar-SA/index.ts

# 6. Validate
npm run i18n:validate
npm run i18n:validate-sizes
```

---

## Critical Rules

### ğŸš¨ MANDATORY - NEVER SKIP

1. **â›” STATIC IMPORTS DEPRECATED**
   - `i18n/static-imports.ts` is **DEPRECATED** and must NEVER be modified
   - Using it destroys performance (19s server startup vs 1.8s)
   - Only export from locale `index.ts` files

2. **âœ… NAMESPACE REGISTRATION (TOP FAILURE POINT)**
   - EVERY namespace MUST be exported from 3 locale index files:
     - `i18n/messages/en-US/index.ts`
     - `i18n/messages/bn-BD/index.ts`
     - `i18n/messages/ar-SA/index.ts`
   - Without this, language switcher BREAKS!

3. **âœ… SERVER-WRAPPER PATTERN (MANDATORY)**
   - All client components with i18n MUST use server-wrapper
   - Prevents translation keys from showing in UI
   - Enables dynamic i18n loading (82% smaller bundle)

4. **âœ… ZERO HARDCODED STRINGS**
   - ALL UI text must use `t()` function
   - Includes: labels, placeholders, errors, tooltips, alt text
   - No exceptions - even console messages to users

5. **âœ… KEBAB-CASE NAMING**
   - Namespaces: `chart-of-accounts` âœ… NOT `chartOfAccounts` âŒ
   - Keys: `save-and-continue` âœ… NOT `saveAndContinue` âŒ

6. **âš ï¸ FILE SIZE LIMITS**
   - Translation files: MAX 40KB (~400 keys) - Enterprise performance target
   - Large datasets: Use `/mocks/` directory (dynamic import)
   - NEVER statically import >400 keys into i18n (causes freeze!)

---

## Step-by-Step Implementation

### Step 1: Create Translation Files

Create files for all three primary locales:

```bash
# English (master - most complete)
i18n/messages/en-US/[namespace].json

# Bengali (second priority)
i18n/messages/bn-BD/[namespace].json

# Arabic (minimum stub)
i18n/messages/ar-SA/[namespace].json
```

**Translation File Structure:**
```json
{
  "title": "Page Title",
  "subtitle": "Page Subtitle",
  "fields": {
    "first-name": "First Name",
    "last-name": "Last Name",
    "email": "Email Address"
  },
  "actions": {
    "save": "Save",
    "cancel": "Cancel",
    "submit": "Submit"
  },
  "messages": {
    "success": "Successfully saved",
    "error": "An error occurred",
    "loading": "Loading..."
  },
  "validation": {
    "required": "This field is required",
    "invalid-email": "Please enter a valid email"
  },
  "states": {
    "empty": "No data available",
    "loading": "Loading data..."
  }
}
```

### Step 2: Register Namespace (CRITICAL!)

**â›” DO NOT MODIFY `i18n/static-imports.ts` - IT IS DEPRECATED!**

Only export from locale index files:

#### 2.1 Register in English Index
```typescript
// File: i18n/messages/en-US/index.ts

// Add this export line
export { default as myModule } from './my-module.json';
```

#### 2.2 Register in Bengali Index
```typescript
// File: i18n/messages/bn-BD/index.ts

// Add this export line
export { default as myModule } from './my-module.json';
```

#### 2.3 Register in Arabic Index
```typescript
// File: i18n/messages/ar-SA/index.ts

// Add this export line
export { default as myModule } from './my-module.json';
```

**Why this is CRITICAL:**
- Dynamic loader (`i18n/request.ts`) uses: `await import(\`./messages/\${locale}/index\`)`
- Without exports, namespace won't be loaded
- Language switcher will break
- Translation keys will show instead of text

### Step 3: Implement Server-Wrapper Pattern

**âŒ WRONG - Client-Only (Causes issues):**
```typescript
'use client';
import { useTranslations } from 'next-intl';

export default function MyPage() {
  const t = useTranslations('my-namespace');
  return <div>{t('title')}</div>;  // May show "my-namespace.title"
}
```

**âœ… CORRECT - Server-Wrapper Pattern:**

**File 1: Wrapper (Server Component)**
```typescript
// File: app/(main)/my-module/MyPageWrapper.tsx
import { getTranslations } from 'next-intl/server';
import dynamic from 'next/dynamic';

// Dynamic import for client component
const MyPageClient = dynamic(() => import('./MyPageClient'), {
  loading: () => <div>Loading...</div>,
  ssr: false  // CRITICAL: Enables dynamic i18n
});

export default async function MyPageWrapper() {
  // Pre-load translations server-side
  await getTranslations('my-namespace');
  return <MyPageClient />;
}
```

**File 2: Client Component**
```typescript
// File: app/(main)/my-module/MyPageClient.tsx
'use client';
import { useTranslations } from 'next-intl';

export default function MyPageClient() {
  const t = useTranslations('my-namespace');

  return (
    <div>
      <h1>{t('title')}</h1>
      <p>{t('subtitle')}</p>
      <button>{t('actions.save')}</button>
    </div>
  );
}
```

**File 3: Thin Page File**
```typescript
// File: app/(main)/my-module/page.tsx
import MyPageWrapper from './MyPageWrapper';

export default function Page() {
  return <MyPageWrapper />;
}
```

**Benefits of Server-Wrapper:**
- âœ… Prevents translation keys from showing
- âœ… Enables dynamic i18n (82% smaller bundle)
- âœ… 88.5% faster server startup
- âœ… 50% faster page compilation
- âœ… SEO-friendly with pre-loaded translations

### Step 4: Use Translations in Components

```typescript
// Server Components
import { getTranslations } from 'next-intl/server';

export default async function ServerComponent() {
  const t = await getTranslations('namespace');
  return <h1>{t('title')}</h1>;
}

// Client Components (inside server wrapper)
'use client';
import { useTranslations } from 'next-intl';

export default function ClientComponent() {
  const t = useTranslations('namespace');
  return <h1>{t('title')}</h1>;
}

// With interpolation
t('welcome-message', { name: 'John' })
// Translation: "Welcome, {name}!"
```

### Step 5: Naming Conventions

**Namespace Names (kebab-case):**
```typescript
âœ… CORRECT
'payroll-onboarding'
'bd-payroll'
'chart-of-accounts'
'journal-entries'
'fixed-assets'

âŒ WRONG
'payrollOnboarding'   // camelCase
'payroll_onboarding'  // snake_case
'PayrollOnboarding'   // PascalCase
```

**Translation Keys (kebab-case):**
```json
{
  "save-and-continue": "Save and Continue",    âœ…
  "first-name": "First Name",                  âœ…
  "email-address": "Email Address",            âœ…

  "saveAndContinue": "...",                    âŒ
  "firstName": "...",                          âŒ
  "email_address": "..."                       âŒ
}
```

---

## Common Failures & Solutions

### Problem 1: Translation Keys Showing in UI

**Symptom:** UI shows `namespace.key` instead of translated text

**Cause:** Namespace not exported from locale index files

**Solution:**
```bash
# 1. Check if namespace is exported
grep "myModule" i18n/messages/en-US/index.ts
grep "myModule" i18n/messages/bn-BD/index.ts
grep "myModule" i18n/messages/ar-SA/index.ts

# 2. If missing, add exports
echo "export { default as myModule } from './my-module.json';" >> i18n/messages/en-US/index.ts
echo "export { default as myModule } from './my-module.json';" >> i18n/messages/bn-BD/index.ts
echo "export { default as myModule } from './my-module.json';" >> i18n/messages/ar-SA/index.ts

# 3. Restart dev server
npm run dev
```

### Problem 2: Language Switcher Not Working

**Symptom:** Clicking language switcher doesn't change text

**Cause:**
- Missing locale prefix in URL
- Namespace not registered
- Client-only pattern without server wrapper

**Solution:**
1. Ensure URL has locale: `/en-US/my-page` not `/my-page`
2. Complete namespace registration (Step 2)
3. Use server-wrapper pattern (Step 3)

### Problem 3: Performance Issues / Slow Server Start

**Symptom:** Server takes >5 seconds to start

**Cause:** Modified `static-imports.ts` or statically importing large data

**Solution:**
```bash
# 1. Check if static-imports.ts was modified
git diff i18n/static-imports.ts

# 2. If modified, REVERT immediately
git checkout i18n/static-imports.ts

# 3. Move large datasets to /mocks/
# Example: bd-vat-location.json (4500+ keys) â†’ mocks/bd-locations/

# 4. Verify server startup time
npm run dev  # Should be < 3 seconds
```

### Problem 4: File Size Too Large

**Symptom:** Build warning or compilation slow

**Cause:** Translation file exceeds 50KB limit

**Solution:**
```bash
# 1. Check file sizes
npm run i18n:validate-sizes

# 2. Split large namespace into smaller ones
# Example: payroll.json (80KB) â†’
#   - payroll-settings.json
#   - payroll-run.json
#   - payroll-reports.json

# 3. Move data to /mocks/ if not UI text
```

### Problem 5: Hydration Errors

**Symptom:** React hydration mismatch errors

**Cause:** Translations loading after initial render

**Solution:** Use server-wrapper with `ssr: false` (Step 3)

---

## ğŸ”¥ CRITICAL: File Structure Violations

### âŒ WRONG: Wrapper Keys (Causes Key Leakage)

```json
{
  "fa-wizard": {
    "title": "Asset Wizard",
    "subtitle": "Create new asset"
  }
}
```

**Problem:** Creates nested keys like `fa-wizard.fa-wizard.title`

### âœ… CORRECT: Flat Structure

```json
{
  "title": "Asset Wizard",
  "subtitle": "Create new asset",
  "wizard": {
    "step-1": {
      "title": "Basic Information"
    }
  }
}
```

### Validation Commands

```bash
# Validate flat structure
node scripts/validate-i18n-flat-structure.js

# Fix wrapper keys
node scripts/flatten-all-wrappers.js

# Check for key leakage
node scripts/fix-key-leakage.js
```

---

## Validation & Testing

### Validation Commands

```bash
# Check all locales for consistency
npm run i18n:validate

# Find missing translations
npm run i18n:missing

# Check file sizes (must be < 50KB)
npm run i18n:validate-sizes

# Full audit
npm run i18n:audit
```

### Testing Checklist

```bash
# 1. Start dev server
npm run dev

# 2. Test all primary locales
http://localhost:8009/en-US/my-page  # English
http://localhost:8009/bn-BD/my-page  # Bengali
http://localhost:8009/ar-SA/my-page  # Arabic (RTL)

# 3. Use global language switcher
# - Click language dropdown in header
# - Select different language
# - Verify all text changes
# - Check no keys showing (e.g., "namespace.key")

# 4. Check browser console
# - No translation errors
# - No missing key warnings
# - No hydration errors

# 5. Verify RTL for Arabic
# - Text direction right-to-left
# - UI layout mirrored
# - Icons positioned correctly
```

---

## Code Review Checklist

### ğŸš¨ PERFORMANCE CRITICAL (Check FIRST!)

- [ ] **â›” `i18n/static-imports.ts` was NOT modified**
- [ ] **â›” No static imports added in i18n folder**
- [ ] **âœ… Only locale `index.ts` files were modified**
- [ ] **âœ… Server startup verified < 3s**
- [ ] **âœ… Used server-wrapper pattern**

### i18n Implementation

- [ ] All UI text uses `t()` function
- [ ] No hardcoded strings in JSX
- [ ] Translation files created for 3 locales (en-US, bn-BD, ar-SA)
- [ ] Namespace exported from all locale index files
- [ ] Keys follow kebab-case convention
- [ ] Placeholders translated
- [ ] Error messages translated
- [ ] Success messages translated
- [ ] Loading states translated
- [ ] Empty states translated
- [ ] Tooltips translated
- [ ] Alt text translated
- [ ] Form validation messages use `t()`
- [ ] No console.log with UI text

### Common Missed Strings

```typescript
// âŒ WRONG - Often missed:
placeholder="Enter name"
alt="Profile picture"
title="Click to edit"
toast.success("Saved!")
{loading ? "Loading..." : "Submit"}

// âœ… CORRECT:
placeholder={t('fields.name-placeholder')}
alt={t('images.profile-alt')}
title={t('actions.edit-tooltip')}
toast.success(t('messages.saved'))
{loading ? t('states.loading') : t('actions.submit')}
```

### File Size & Structure

- [ ] Translation files < 50KB
- [ ] No wrapper keys (flat structure)
- [ ] No key leakage (values are text, not keys)
- [ ] Large datasets moved to `/mocks/`

### Testing

- [ ] Tested with language switcher
- [ ] No translation keys visible
- [ ] RTL tested for Arabic
- [ ] URL includes locale prefix
- [ ] No hydration errors
- [ ] No console warnings

---

## ğŸ”´ Quick Reference: Critical Don'ts

1. **â›” NEVER** modify `i18n/static-imports.ts` (deprecated)
2. **â›” NEVER** skip namespace registration
3. **â›” NEVER** use client-only pattern without wrapper
4. **â›” NEVER** use camelCase for namespaces/keys
5. **â›” NEVER** hardcode ANY user-facing text
6. **â›” NEVER** statically import large datasets (>500 keys)
7. **â›” NEVER** create wrapper keys in JSON
8. **â›” NEVER** exceed 50KB per translation file

---

## ğŸ“Š Supported Locales (47 Languages)

**Primary (3):**
- `en-US` - English (DEFAULT & FALLBACK)
- `bn-BD` - à¦¬à¦¾à¦‚à¦²à¦¾ (Bengali)
- `ar-SA` - Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Arabic) - RTL

**Major World (8):**
- `hi-IN`, `es-ES`, `fr-FR`, `de-DE`, `zh-CN`, `ja-JP`, `pt-BR`, `ru-RU`

**Indian Subcontinent (12):**
- `ur-PK` (RTL), `ne-NP`, `si-LK`, `pa-IN`, `mr-IN`, `or-IN`, `as-IN`, `gu-IN`, `kn-IN`, `ml-IN`, `ta-IN`, `te-IN`

**East African (2):**
- `sw-KE`, `am-ET`

**European (22):**
- `sq-AL`, `bs-BA`, `bg-BG`, `hr-HR`, `cs-CZ`, `da-DK`, `nl-NL`, `et-EE`, `fi-FI`, `el-GR`, `hu-HU`, `is-IS`, `ga-IE`, `it-IT`, `lv-LV`, `lt-LT`, `mk-MK`, and more...

---

## ğŸ“ File Structure Reference

```
i18n/
â”œâ”€â”€ static-imports.ts         # â›” DEPRECATED - DO NOT MODIFY!
â”œâ”€â”€ request.ts                # âœ… Dynamic loader (don't touch)
â”œâ”€â”€ config.ts                 # Locale configuration
â”œâ”€â”€ messages/
â”‚   â”œâ”€â”€ en-US/
â”‚   â”‚   â”œâ”€â”€ index.ts         # âœ… EXPORT NAMESPACES HERE
â”‚   â”‚   â”œâ”€â”€ my-module.json
â”‚   â”‚   â””â”€â”€ another-module.json
â”‚   â”œâ”€â”€ bn-BD/
â”‚   â”‚   â”œâ”€â”€ index.ts         # âœ… EXPORT NAMESPACES HERE
â”‚   â”‚   â”œâ”€â”€ my-module.json
â”‚   â”‚   â””â”€â”€ another-module.json
â”‚   â””â”€â”€ ar-SA/
â”‚       â”œâ”€â”€ index.ts         # âœ… EXPORT NAMESPACES HERE
â”‚       â”œâ”€â”€ my-module.json
â”‚       â””â”€â”€ another-module.json
```

---

## ğŸš€ Performance Benchmarks

| Metric | Dynamic (Current) | Static (Deprecated) | Improvement |
|--------|------------------|---------------------|-------------|
| Server Startup | 1.8s | 19.1s | 88.5% faster |
| Bundle Size | ~400KB | 2.5MB | 82% smaller |
| Page Compilation | ~1s | ~2s | 50% faster |
| Initial Load | < 2s | > 4s | 50% faster |

---

## ğŸ“š Related Documentation

- **CLAUDE.md** - Project guidelines and auto-approval rules
- **BUILD.md** - Build pipeline integration (Phase 2.0, 2.6.3, 3.1)
- **I18N.md** - Detailed implementation guide
- **API-MIDDLEWARE-TEMPLATE-GUIDE.md** - API documentation patterns

---

## âœ… Quick Checklist for New Pages

- [ ] Translation JSON files created (en-US, bn-BD, ar-SA)
- [ ] Namespace uses kebab-case
- [ ] **â›” Did NOT modify `static-imports.ts`**
- [ ] âœ… Exported from `en-US/index.ts`
- [ ] âœ… Exported from `bn-BD/index.ts`
- [ ] âœ… Exported from `ar-SA/index.ts`
- [ ] Using server-wrapper pattern
- [ ] All hardcoded strings replaced with `t()`
- [ ] Tested with language switcher
- [ ] No translation keys visible
- [ ] URL includes locale prefix
- [ ] Server startup < 3s
- [ ] Files < 50KB
- [ ] Flat structure (no wrappers)
- [ ] Validation passed

---

## ğŸš¨ CURRENT ISSUES (Audit: 2025-12-08)

### Critical File Size Violations

**116 files exceed the 50KB limit.** Top offenders:

| File | Size | % Over Limit | Root Cause |
|------|------|--------------|------------|
| `gl.json` | 290-304 KB | 662% | Duplicate `coa` section (71KB) + `advancedAccount` (44KB) |
| `admin.json` | 117-128 KB | 222% | Large `storage` section (72KB) |
| `banking.json` | 118-126 KB | 215% | Needs size-based splitting |
| `payroll.json` | 98-105 KB | 164% | Needs size-based splitting |
| `governance-compliance.json` | 67-70 KB | 75% | Needs splitting |

### Duplicate Data Issues

1. **gl.json** contains `coa` section (71KB) but `coa.json` already exists (49KB) - duplicate!
2. Need to remove duplicate sections and use single source of truth

### Remediation Plan

1. **Remove duplicates**: Extract `coa` from `gl.json`, use existing `coa.json`
2. **Split large nested objects**: `storage` in admin.json, `advancedAccount` in gl.json
3. **Run split script**: `node scripts/split-large-i18n-files.js`
4. **Update component imports**: Change namespaces from `gl` to `gl-coa`, etc.
5. **Register new namespaces**: Add exports to all 3 locale index.ts files

### Commands to Run

```bash
# Check current file sizes
npm run i18n:validate-sizes

# Run the split script (dry-run first)
node scripts/split-large-i18n-files.js --dry-run

# Run for real
node scripts/split-large-i18n-files.js

# Validate after changes
npm run i18n:validate
```

---

**Last Updated:** 2025-12-08
**Version:** 2.1
**Status:** âš ï¸ Active - Issues Found (see above)


---

## ğŸš¨ CURRENT ISSUES (Audit: 2025-12-08)

### Critical File Size Violations

**116 files exceed the 50KB limit.** Top offenders:

| File | Size | % Over Limit | Root Cause |
|------|------|--------------|------------|
| `gl.json` | 290-304 KB | 662% | Duplicate `coa` section (71KB) + `advancedAccount` (44KB) |
| `admin.json` | 117-128 KB | 222% | Large `storage` section (72KB) |
| `banking.json` | 118-126 KB | 215% | Needs size-based splitting |
| `payroll.json` | 98-105 KB | 164% | Needs size-based splitting |
| `governance-compliance.json` | 67-70 KB | 75% | Needs splitting |

### Duplicate Data Issues

1. **gl.json** contains `coa` section (71KB) but `coa.json` already exists (49KB) - duplicate!
2. Need to remove duplicate sections and use single source of truth

### Remediation Plan

1. **Remove duplicates**: Extract `coa` from `gl.json`, use existing `coa.json`
2. **Split large nested objects**: `storage` in admin.json, `advancedAccount` in gl.json
3. **Run split script**: `node scripts/split-large-i18n-files.js`
4. **Update component imports**: Change namespaces from `gl` to `gl-coa`, etc.
5. **Register new namespaces**: Add exports to all 3 locale index.ts files

### Commands to Run

```bash
# Check current file sizes
npm run i18n:validate-sizes

# Run the split script (dry-run first)
node scripts/split-large-i18n-files.js --dry-run

# Run for real
node scripts/split-large-i18n-files.js

# Validate after changes
npm run i18n:validate
```
